From eb34177f1db31df3276b3d5ae1207390b1bb1edf Mon Sep 17 00:00:00 2001
From: Nikos Mavrogiannopoulos <nmav@redhat.com>
Date: Thu, 27 Nov 2014 16:24:08 +0000
Subject: [PATCH] When compiling with old gnutls version completely disable
 ECDHE instead of disabling the curves

Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
---
 gnutls.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/gnutls.c b/gnutls.c
index e4fcfb7..feb1b27 100644
--- a/gnutls.c
+++ b/gnutls.c
@@ -1971,7 +1971,7 @@ static int verify_peer(gnutls_session_t session)
 # define _DEFAULT_PRIO "NORMAL:-VERS-TLS-ALL:+VERS-TLS1.0:" \
 	"%COMPAT:%DISABLE_SAFE_RENEGOTIATION:%LATEST_RECORD_VERSION"
 # if GNUTLS_VERSION_MAJOR >= 3
-#  define DEFAULT_PRIO _DEFAULT_PRIO":-CURVE-ALL"
+#  define DEFAULT_PRIO _DEFAULT_PRIO":-CURVE-ALL:-ECDHE-RSA:-ECDHE-ECDSA"
 #else
 #  define DEFAULT_PRIO _DEFAULT_PRIO
 # endif
-- 
2.1.0

--- ./version.c.orig	2014-11-27 16:39:58.924714506 +0000
+++ ./version.c	2014-11-27 16:40:00.648735281 +0000
@@ -1 +1 @@
-const char *openconnect_version_str = "v7.00";
+const char *openconnect_version_str = "v7.00-1-geb34177";
